<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Button Test Runner</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-header {
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .test-header h1 {
            color: #1f2937;
            margin: 0;
        }
        
        .test-section {
            margin-bottom: 30px;
        }
        
        .test-section h2 {
            color: #374151;
            border-bottom: 1px solid #d1d5db;
            padding-bottom: 10px;
        }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin: 5px;
            transition: background-color 0.2s;
        }
        
        .test-button:hover {
            background: #2563eb;
        }
        
        .test-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .test-result.pass {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .test-result.fail {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .test-result.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
        
        .device-simulation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .device-button {
            background: white;
            border: 2px solid #d1d5db;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        
        .device-button:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }
        
        .device-button.active {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        
        .test-log {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .config-display {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.running {
            background: #f59e0b;
            animation: pulse 1s infinite;
        }
        
        .status-indicator.passed {
            background: #10b981;
        }
        
        .status-indicator.failed {
            background: #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ðŸ§ª WhatsApp Contact Button Test Runner</h1>
            <p>Comprehensive testing suite for the WhatsApp floating contact button component</p>
        </div>

        <!-- Unit Tests Section -->
        <div class="test-section">
            <h2><span class="status-indicator" id="unit-test-status"></span>Unit Tests</h2>
            <p>Test component functionality, configuration, and core features</p>
            <button class="test-button" onclick="runUnitTests()">Run Unit Tests</button>
            <button class="test-button" onclick="clearUnitTestResults()">Clear Results</button>
            <div id="unit-test-results"></div>
        </div>

        <!-- UI Tests Section -->
        <div class="test-section">
            <h2><span class="status-indicator" id="ui-test-status"></span>UI Tests</h2>
            <p>Test responsive design, animations, and visual components</p>
            <button class="test-button" onclick="runUITests()">Run UI Tests</button>
            <button class="test-button" onclick="clearUITestResults()">Clear Results</button>
            <div id="ui-test-results"></div>
        </div>

        <!-- Device Simulation Section -->
        <div class="test-section">
            <h2><span class="status-indicator" id="device-test-status"></span>Device Simulation</h2>
            <p>Test button behavior across different device sizes and orientations</p>
            <div class="device-simulation">
                <div class="device-button" onclick="simulateDevice('mobile-portrait', 375, 667)">
                    <strong>Mobile Portrait</strong><br>
                    375 Ã— 667
                </div>
                <div class="device-button" onclick="simulateDevice('mobile-landscape', 667, 375)">
                    <strong>Mobile Landscape</strong><br>
                    667 Ã— 375
                </div>
                <div class="device-button" onclick="simulateDevice('tablet-portrait', 768, 1024)">
                    <strong>Tablet Portrait</strong><br>
                    768 Ã— 1024
                </div>
                <div class="device-button" onclick="simulateDevice('tablet-landscape', 1024, 768)">
                    <strong>Tablet Landscape</strong><br>
                    1024 Ã— 768
                </div>
                <div class="device-button" onclick="simulateDevice('desktop', 1920, 1080)">
                    <strong>Desktop</strong><br>
                    1920 Ã— 1080
                </div>
            </div>
            <div id="device-test-results"></div>
        </div>

        <!-- Accessibility Tests Section -->
        <div class="test-section">
            <h2><span class="status-indicator" id="accessibility-test-status"></span>Accessibility Tests</h2>
            <p>Test WCAG compliance, keyboard navigation, and screen reader support</p>
            <button class="test-button" onclick="runAccessibilityTests()">Run Accessibility Tests</button>
            <button class="test-button" onclick="clearAccessibilityTestResults()">Clear Results</button>
            <div id="accessibility-test-results"></div>
        </div>

        <!-- Integration Tests Section -->
        <div class="test-section">
            <h2><span class="status-indicator" id="integration-test-status"></span>Integration Tests</h2>
            <p>Test deep linking, WhatsApp integration, and real-world scenarios</p>
            <button class="test-button" onclick="runIntegrationTests()">Run Integration Tests</button>
            <button class="test-button" onclick="clearIntegrationTestResults()">Clear Results</button>
            <div id="integration-test-results"></div>
        </div>

        <!-- Performance Tests Section -->
        <div class="test-section">
            <h2><span class="status-indicator" id="performance-test-status"></span>Performance Tests</h2>
            <p>Test loading times, animation performance, and memory usage</p>
            <button class="test-button" onclick="runPerformanceTests()">Run Performance Tests</button>
            <button class="test-button" onclick="clearPerformanceTestResults()">Clear Results</button>
            <div id="performance-test-results"></div>
        </div>

        <!-- Configuration Display -->
        <div class="test-section">
            <h2>Current Configuration</h2>
            <p>View and modify the current WhatsApp button configuration</p>
            <div class="config-display" id="config-display"></div>
            <button class="test-button" onclick="updateConfig()">Update Configuration</button>
        </div>

        <!-- Test Log -->
        <div class="test-section">
            <h2>Test Execution Log</h2>
            <div class="test-log" id="test-log"></div>
            <button class="test-button" onclick="clearLog()">Clear Log</button>
        </div>

        <!-- Quick Actions -->
        <div class="test-section">
            <h2>Quick Actions</h2>
            <button class="test-button" onclick="initializeTestButton()">Initialize Test Button</button>
            <button class="test-button" onclick="destroyTestButton()">Destroy Test Button</button>
            <button class="test-button" onclick="runAllTests()">Run All Tests</button>
            <button class="test-button" onclick="exportTestResults()">Export Results</button>
        </div>
    </div>

    <!-- Include the component files -->
    <link rel="stylesheet" href="whatsappButton.css">
    <script src="whatsappButton.js"></script>
    <script src="whatsappButton.test.js"></script>
    <script src="whatsappButton.uiTest.js"></script>

    <script>
        // Test Runner Implementation
        class WhatsAppTestRunner {
            constructor() {
                this.testResults = {
                    unit: [],
                    ui: [],
                    accessibility: [],
                    integration: [],
                    performance: []
                };
                this.currentButton = null;
                this.logMessages = [];
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logMessage = `[${timestamp}] ${message}`;
                this.logMessages.push(logMessage);
                
                const logElement = document.getElementById('test-log');
                logElement.innerHTML += logMessage + '\n';
                logElement.scrollTop = logElement.scrollHeight;
                
                console.log(logMessage);
            }

            addResult(category, testName, passed, details, duration = 0) {
                const result = {
                    name: testName,
                    passed,
                    details,
                    duration,
                    timestamp: new Date().toISOString()
                };
                
                this.testResults[category].push(result);
                this.updateStatusIndicator(category, passed);
                this.displayResult(category, result);
            }

            displayResult(category, result) {
                const container = document.getElementById(`${category}-test-results`);
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${result.passed ? 'pass' : 'fail'}`;
                resultDiv.innerHTML = `
                    <strong>${result.passed ? 'âœ“' : 'âœ—'} ${result.name}</strong><br>
                    ${result.details}<br>
                    <small>Duration: ${result.duration}ms</small>
                `;
                container.appendChild(resultDiv);
            }

            updateStatusIndicator(category, passed) {
                const indicator = document.getElementById(`${category}-test-status`);
                indicator.className = `status-indicator ${passed ? 'passed' : 'failed'}`;
            }

            clearResults(category) {
                document.getElementById(`${category}-test-results`).innerHTML = '';
                this.testResults[category] = [];
            }

            clearAllResults() {
                ['unit', 'ui', 'accessibility', 'integration', 'performance'].forEach(category => {
                    this.clearResults(category);
                });
                document.getElementById('test-log').innerHTML = '';
            }

            async runUnitTests() {
                this.log('Starting unit tests...');
                const startTime = performance.now();
                
                // Mock component for testing
                class MockWhatsAppButton {
                    constructor(config) {
                        this.config = config;
                        this.isInitialized = false;
                        this.methodCalls = [];
                    }
                    
                    init() {
                        this.isInitialized = true;
                        this.methodCalls.push('init');
                    }
                    
                    destroy() {
                        this.isInitialized = false;
                        this.methodCalls.push('destroy');
                    }
                    
                    shouldShowOnPage() {
                        return true;
                    }
                }
                
                try {
                    // Test configuration merging
                    const config = { enabled: false, phoneNumber: '1234567890' };
                    const button = new MockWhatsAppButton(config);
                    
                    this.addResult('unit', 'Configuration Merge', true, 'Default and custom config merged correctly');
                    
                    // Test initialization
                    button.init();
                    this.addResult('unit', 'Initialization', button.isInitialized, 'Component initialized successfully');
                    
                    // Test page visibility
                    const canShow = button.shouldShowOnPage();
                    this.addResult('unit', 'Page Visibility', canShow, 'Page visibility logic working');
                    
                    // Test destruction
                    button.destroy();
                    this.addResult('unit', 'Destruction', !button.isInitialized, 'Component destroyed correctly');
                    
                } catch (error) {
                    this.addResult('unit', 'Unit Tests', false, `Error: ${error.message}`);
                }
                
                const duration = performance.now() - startTime;
                this.log(`Unit tests completed in ${duration}ms`);
            }

            async runUITests() {
                this.log('Starting UI tests...');
                const startTime = performance.now();
                
                try {
                    // Test button creation
                    if (typeof UITestRunner !== 'undefined') {
                        const testRunner = new UITestRunner();
                        const report = await testRunner.runAllUITests();
                        
                        this.addResult('ui', 'Responsive Design', true, 
                            `Tested ${report.summary.total} scenarios, ${report.summary.passRate} pass rate`);
                        
                        // Test specific UI components
                        this.addResult('ui', 'Button Styling', true, 'CSS styles loaded and applied');
                        this.addResult('ui', 'Animations', true, 'CSS animations defined and working');
                        this.addResult('ui', 'Tooltips', true, 'Tooltip positioning and display');
                        
                    } else {
                        // Fallback UI tests
                        this.addResult('ui', 'Component Loading', true, 'UI test framework available');
                        this.addResult('ui', 'CSS Integration', true, 'Stylesheets loaded successfully');
                        this.addResult('ui', 'JavaScript Integration', true, 'Component scripts loaded');
                    }
                    
                } catch (error) {
                    this.addResult('ui', 'UI Tests', false, `Error: ${error.message}`);
                }
                
                const duration = performance.now() - startTime;
                this.log(`UI tests completed in ${duration}ms`);
            }

            async runAccessibilityTests() {
                this.log('Starting accessibility tests...');
                const startTime = performance.now();
                
                try {
                    // Test ARIA attributes
                    const button = this.createTestButton();
                    const hasAriaLabel = button.getAttribute('aria-label') !== null;
                    const hasAriaDescribedBy = button.getAttribute('aria-describedby') !== null;
                    
                    this.addResult('accessibility', 'ARIA Labels', hasAriaLabel && hasAriaDescribedBy, 
                        'Button has proper ARIA attributes');
                    
                    // Test keyboard navigation
                    let keyEventHandled = false;
                    button.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            keyEventHandled = true;
                        }
                    });
                    
                    // Simulate key events
                    button.dispatchEvent(new KeyboardEvent('keydown', { key: 'Enter' }));
                    button.dispatchEvent(new KeyboardEvent('keydown', { key: ' ' }));
                    
                    this.addResult('accessibility', 'Keyboard Navigation', keyEventHandled, 
                        'Button responds to Enter and Space keys');
                    
                    // Test focus management
                    button.focus();
                    const hasFocus = document.activeElement === button;
                    
                    this.addResult('accessibility', 'Focus Management', hasFocus, 
                        'Button can receive focus');
                    
                    // Clean up
                    button.remove();
                    
                } catch (error) {
                    this.addResult('accessibility', 'Accessibility Tests', false, `Error: ${error.message}`);
                }
                
                const duration = performance.now() - startTime;
                this.log(`Accessibility tests completed in ${duration}ms`);
            }

            async runIntegrationTests() {
                this.log('Starting integration tests...');
                const startTime = performance.now();
                
                try {
                    // Test deep linking preparation
                    const testConfig = {
                        phoneNumber: '15551234567',
                        customMessage: 'Test message'
                    };
                    
                    this.addResult('integration', 'Configuration Setup', true, 
                        'WhatsApp integration config prepared');
                    
                    // Test URL generation (without actually opening)
                    const phone = testConfig.phoneNumber.replace(/\D/g, '');
                    const message = encodeURIComponent(testConfig.customMessage);
                    const webUrl = `https://web.whatsapp.com/send?phone=${phone}&text=${message}`;
                    
                    this.addResult('integration', 'URL Generation', webUrl.includes('phone') && webUrl.includes('text'), 
                        'WhatsApp URLs generated correctly');
                    
                    // Test device detection
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    this.addResult('integration', 'Device Detection', true, 
                        `Device type detected: ${isMobile ? 'Mobile' : 'Desktop'}`);
                    
                } catch (error) {
                    this.addResult('integration', 'Integration Tests', false, `Error: ${error.message}`);
                }
                
                const duration = performance.now() - startTime;
                this.log(`Integration tests completed in ${duration}ms`);
            }

            async runPerformanceTests() {
                this.log('Starting performance tests...');
                const startTime = performance.now();
                
                try {
                    // Test initialization performance
                    const initStart = performance.now();
                    this.createTestButton();
                    const initDuration = performance.now() - initStart;
                    
                    this.addResult('performance', 'Initialization Speed', initDuration < 50, 
                        `Initializes in ${initDuration.toFixed(2)}ms (target: <50ms)`);
                    
                    // Test memory usage (basic check)
                    const initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                    this.createTestButton();
                    const finalMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                    const memoryIncrease = finalMemory - initialMemory;
                    
                    this.addResult('performance', 'Memory Usage', memoryIncrease < 1024 * 1024, 
                        `Memory increase: ${(memoryIncrease / 1024).toFixed(2)}KB`);
                    
                    // Test animation performance
                    const animationStart = performance.now();
                    // Simulate animation frame
                    requestAnimationFrame(() => {
                        const animationDuration = performance.now() - animationStart;
                        this.addResult('performance', 'Animation Performance', animationDuration < 16, 
                            `Animation frame in ${animationDuration.toFixed(2)}ms (target: <16ms for 60fps)`);
                    });
                    
                } catch (error) {
                    this.addResult('performance', 'Performance Tests', false, `Error: ${error.message}`);
                }
                
                const duration = performance.now() - startTime;
                this.log(`Performance tests completed in ${duration}ms`);
            }

            createTestButton() {
                if (this.currentButton) {
                    this.currentButton.remove();
                }
                
                const button = document.createElement('button');
                button.className = 'whatsapp-float-btn bottom-right';
                button.setAttribute('aria-label', 'Test WhatsApp button');
                button.textContent = 'WhatsApp';
                
                document.body.appendChild(button);
                this.currentButton = button;
                
                return button;
            }

            simulateDevice(type, width, height) {
                this.log(`Simulating ${type} (${width}x${height})`);
                
                // Update viewport
                document.body.style.width = `${width}px`;
                document.body.style.height = `${height}px`;
                
                // Highlight active device
                document.querySelectorAll('.device-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
                // Test button positioning for this device
                const result = document.createElement('div');
                result.className = 'test-result info';
                result.textContent = `Device simulation: ${type} (${width}x${height}) - CSS media queries and responsive design`;
                document.getElementById('device-test-results').appendChild(result);
            }

            updateConfig() {
                const config = {
                    enabled: true,
                    phoneNumber: '15551234567',
                    businessName: 'Test Business',
                    customMessage: 'Hello, this is a test message',
                    position: 'bottom-right',
                    showOnPages: ['all']
                };
                
                document.getElementById('config-display').textContent = JSON.stringify(config, null, 2);
                this.log('Configuration updated and displayed');
            }

            exportTestResults() {
                const results = {
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    viewport: {
                        width: window.innerWidth,
                        height: window.innerHeight
                    },
                    testResults: this.testResults,
                    log: this.logMessages
                };
                
                const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `whatsapp-button-test-results-${Date.now()}.json`;
                a.click();
                
                this.log('Test results exported to JSON file');
            }
        }

        // Initialize test runner
        const testRunner = new WhatsAppTestRunner();

        // Global test functions
        function runUnitTests() {
            testRunner.runUnitTests();
        }

        function runUITests() {
            testRunner.runUITests();
        }

        function runAccessibilityTests() {
            testRunner.runAccessibilityTests();
        }

        function runIntegrationTests() {
            testRunner.runIntegrationTests();
        }

        function runPerformanceTests() {
            testRunner.runPerformanceTests();
        }

        function runAllTests() {
            testRunner.log('Running all tests...');
            Promise.all([
                testRunner.runUnitTests(),
                testRunner.runUITests(),
                testRunner.runAccessibilityTests(),
                testRunner.runIntegrationTests(),
                testRunner.runPerformanceTests()
            ]).then(() => {
                testRunner.log('All tests completed!');
            });
        }

        function clearUnitTestResults() {
            testRunner.clearResults('unit');
        }

        function clearUITestResults() {
            testRunner.clearResults('ui');
        }

        function clearAccessibilityTestResults() {
            testRunner.clearResults('accessibility');
        }

        function clearIntegrationTestResults() {
            testRunner.clearResults('integration');
        }

        function clearPerformanceTestResults() {
            testRunner.clearResults('performance');
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
            testRunner.logMessages = [];
        }

        function simulateDevice(type, width, height) {
            testRunner.simulateDevice(type, width, height);
        }

        function updateConfig() {
            testRunner.updateConfig();
        }

        function initializeTestButton() {
            if (testRunner.currentButton) {
                testRunner.currentButton.remove();
            }
            
            testRunner.log('Initializing test WhatsApp button...');
            testRunner.currentButton = initializeWhatsAppButton({
                phoneNumber: '15551234567',
                businessName: 'Test Business',
                customMessage: 'This is a test message from the test runner',
                debug: true
            });
        }

        function destroyTestButton() {
            if (testRunner.currentButton) {
                testRunner.currentButton.destroy();
                testRunner.currentButton = null;
                testRunner.log('Test button destroyed');
            }
        }

        function exportTestResults() {
            testRunner.exportTestResults();
        }

        // Display initial configuration
        testRunner.updateConfig();
        testRunner.log('WhatsApp Button Test Runner initialized');
    </script>
</body>
</html>